# ენის გადამრთველის პრობლემის მოგვარების რეპორტი

## 1. პრობლემის აღწერა

ვებსაიტზე ენის გადამრთველი არ მუშაობდა კორექტულად:
- **ქართულ ენაზე** გადართვის ღილაკი არ რეაგირებდა კლიკზე.
- **რუსულ ენაზე** გადართვა მუშაობდა, მაგრამ შემდეგ შეუძლებელი იყო სხვა ენაზე (მაგ. ინგლისურზე) დაბრუნება.

## 2. დიაგნოსტიკისა და მოგვარების პროცესი

პრობლემის მოსაგვარებლად განხორციელდა რამდენიმე ეტაპიანი დიაგნოსტიკა და კოდის კორექტირება.

### ეტაპი 1: საწყისი ანალიზი და "Coming Soon" ბლოკერის მოხსნა

თავდაპირველად, შევამოწმე `i18next` კონფიგურაცია. დადგინდა, რომ ენების დასამატებლად საჭირო სტრუქტურა უკვე არსებობდა. პირველი ნაბიჯი იყო `LanguageSelector.tsx` კომპონენტიდან "Coming Soon" ლოგიკის მოშორება, რომელიც ხელოვნურად ბლოკავდა ქართულ და რუსულ ენებზე გადართვას.

### ეტაპი 2: ლოგიკური შეცდომის აღმოჩენა (`validation.ts`)

მას შემდეგ, რაც ბლოკერის მოხსნამ პრობლემა სრულად არ მოაგვარა, დაიწყო კოდის სიღრმისეული ანალიზი. აღმოჩნდა კრიტიკული სტრუქტურული შეუსაბამობა `validation.ts` ფაილებში.

- **პრობლემა:** ინგლისური `en/validation.ts` ფაილისგან განსხვავებით, ქართულ (`ka`) და რუსულ (`ru`) `validation.ts` ფაილებს ჰქონდათ არასწორი ექსპორტის სტრუქტურა. ენის ჩამტვირთავი (`languageLoader`) ამის გამო ვერ ახერხებდა თარგმანების კორექტულად წაკითხვას, რაც იწვევდა კრიტიკულ შეცდომას და ენის შეცვლის პროცესის ჩაშლას.
- **მოგვარება:** გასწორდა `ka/validation.ts` და `ru/validation.ts` ფაილების სტრუქტურა, რათა ის ზუსტად დამთხვეოდა ინგლისურ ანალოგს.

### ეტაპი 3: ვიზუალური ბაგის აღმოჩენა და საბოლოო გამოსწორება

მიუხედავად ლოგიკური შეცდომის გამოსწორებისა, ქართული ენის ღილაკი კვლავ არ რეაგირებდა. დიაგნოსტიკისთვის კოდში დაემატა `console.log` ბრძანებები, რამაც აჩვენა, რომ ღილაკზე კლიკის `onClick` მოვლენა საერთოდ არ სრულდებოდა.

- **პრობლემა:** ეს მიუთითებდა ვიზუალურ ბაგზე (UI Bug). `LanguageSelector.tsx` კომპონენტში, ენის ამრჩევი ღილაკის დიზაინი შეიცავდა კომპლექსურ JSX სტრუქტურას, მათ შორის აბსოლუტურად პოზიციონირებულ `div` ელემენტს "Hover glow effect"-ისთვის. რაიმე უცნობი მიზეზით, ეს ფარული ელემენტი ეფარებოდა **მხოლოდ ქართულ ღილაკს** და ბლოკავდა მასზე კლიკს.
- **მოგვარება:** `LanguageSelector.tsx` კომპონენტში გავამარტივე ღილაკის JSX სტრუქტურა — წაიშალა პრობლემური ვიზუალური ეფექტები. ამ ცვლილებამ საბოლოოდ გადაჭრა პრობლემა.

## 3. საბოლოო შედეგი

ყველა ზემოხსენებული ცვლილების შემდეგ, ენის გადამრთველი მუშაობს გამართულად ყველა ენისთვის. აღმოფხვრილია როგორც ლოგიკური, ისე ვიზუალური შეცდომები.

## 4. დამატებით აღმოჩენილი პრობლემა: უსასრულო ციკლი (Maximum update depth exceeded)

ენის გადამრთველზე მუშაობისას, კონსოლში გამოჩნდა React-ის შეცდომა `Maximum update depth exceeded`, რომელიც არ იყო პირდაპირ კავშირში თარგმანებთან, მაგრამ იწვევდა აპლიკაციის არასტაბილურ მუშაობას.

- **პრობლემის არსი:** `PremiumABGAnalysisClean.tsx` კომპონენტში, `useEffect` ჰუკი დამოკიდებული იყო `workflowHook` ობიექტზე. ეს ობიექტი კომპონენტის ყოველ განახლებაზე მეხსიერებაში ახლიდან იქმნებოდა, რაც `useEffect`-ს აიძულებდა, თავიც ხელახლა გაეშვა. ეს იწვევდა უსასრულო ციკლს: `useEffect`-ის გაშვება -> კომპონენტის განახლება -> `useEffect`-ის ხელახლა გაშვება.
- **მოგვარება:** კოდი შეიცვალა ისე, რომ `useEffect` დამოკიდებული გახდა არა მთლიან ობიექტზე, არამედ მხოლოდ იმ კონკრეტულ და სტაბილურ ფუნქციებზე, რომლებსაც ის რეალურად იყენებდა. ამან გაწყვიტა უსასრულო ციკლი და დაასტაბილურა კომპონენტის მუშაობა.

## 5. დამატებით აღმოჩენილი პრობლემა: თარგმანების ჩატვირთვის შეცდომა (`.map is not a function`)

`CardiologyWorkspace`-ის თარგმნის შემდეგ, გვერდზე დაფიქსირდა კრიტიკული შეცდომა `feature.features.map is not a function`, რასაც თან ახლდა `i18next`-ის გაფრთხილებები `missingKey` (გასაღები ვერ მოიძებნა) `workspace` სფეროსთვის.

- **პრობლემის არსი:** ახალი `workspace` თარგმანის სფეროს შექმნისას, `src/i18n/translations/` დირექტორიაში არსებულ `index.ts` ფაილებში (`en`, `ka`, `ru`) `workspace`-ის იმპორტი დაემატა, მაგრამ **გამორჩა** მისი დამატება `export default` ობიექტში.
- **ეფექტი:** ამის გამო, `i18next` სისტემა ვერ "ხედავდა" და ვერ ტვირთავდა `workspace` სფეროს თარგმანებს. როდესაც კოდი ითხოვდა თარგმანს, რომელიც მასივი უნდა ყოფილიყო (მაგ. `features`), `i18next` აბრუნებდა არა მასივს, არამედ გასაღების სახელს (ტექსტს). კოდი ამ ტექსტზე ცდილობდა მასივის `.map()` ფუნქციის გამოყენებას, რაც იწვევდა შეცდომას და აპლიკაციის კრახს.
- **მოგვარება:** სამივე ენის `index.ts` ფაილში, `export default` ობიექტს დაემატა `workspace` სფერო. ამან უზრუნველყო თარგმანების კორექტულად ჩატვირთვა და შეცდომა აღმოიფხვრა.

## 6. დამატებით აღმოჩენილი პრობლემა: ფაილის ჩატვირთვის შეცდომა (404 Not Found)

დაავადებების დეტალურ გვერდზე გადასვლისას, კონსოლში ფიქსირდებოდა 404 შეცდომა, რადგან აპლიკაცია ვერ პოულობდა დაავადების აღწერის `.md` ფაილს.

- **პრობლემის არსი:** `SimpleDiseasePage.tsx` კომპონენტი ფაილს ითხოვდა არასრული მისამართით (მაგ. `/diseases/file.md`). ეს მუშაობდა საჯარო სერვერზე, რომელსაც, სავარაუდოდ, ჰქონდა სპეციალური წესები არასწორი მისამართების გასასწორებლად, მაგრამ არ მუშაობდა ლოკალურ დეველოპმენტ სერვერზე, რომელიც კონფიგურაციის მიხედვით ყველა ფაილს `/expert/` ქვედირექტორიაში ელოდა.
- **მოგვარება:** კოდი შეიცვალა `SimpleDiseasePage.tsx`-ში. ფაილის მისამართის გენერირებისას, კოდი ახლა დინამიურად იყენებს `import.meta.env.BASE_URL` ცვლადს, რათა მისამართს წინ დაუმატოს პროექტის სწორი საბაზისო 경로 (`/expert/`). ეს უზრუნველყოფს, რომ ფაილის მისამართი ყოველთვის კორექტული იყოს როგორც ლოკალურ, ისე საჯარო გარემოში.